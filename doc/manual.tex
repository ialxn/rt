\documentclass[10pt,a4paper,titlepage]{article}
\usepackage{hyperref}
%\usepackage[T1]{fontenc}
%\usepackage{textcomp}

\newcommand{\rt}{{\tt rt} }

\title{ {\Huge Manual for \\
		\rt \\
		Version 0.4.1\\
		\vspace{2cm}}}

\author{Dr. Ivo Alxneit \\
	Paul Scherrer Institute \\
	CH-5232 Villigen PSI \\
	SWITZERLAND \\
	\\
	phone: ++41 56 310 4092 \\
	fax: ++41 56 310 4416 \\
	e-mail: ivo.alxneit@psi.ch \\
	\vspace{4cm}}


\begin{document}

\maketitle

\pagenumbering{roman}
\tableofcontents
\pagebreak

\setcounter{page}{1}
\pagenumbering{arabic}



\section{Installation}

To compile and install \rt you need a C-compiler\footnote{\rt is only tested with gcc} and, ideally, {\tt (I)make}. In addition, the following libraries are needed: {\tt GSL}\footnote{Gnu Scientific Library, \url{http://www.gnu.org/software/gsl/}}, a C-version of BLAS (Basic Linear Algebra System) such as {\tt gslcblas} or {\tt Atlas}\footnote{\url{http://math-atlas.sourceforge.net/}}, {\tt libconfig}\footnote{Version 1.4.6+, \url{http://www.hyperrealm.com/libconfig/}}, and {\tt libpthread}. Please set (or modify) {\tt CCOPTIONS} in {\tt Imakefile}. Most probably, you will make sure that {\tt -O2 -g} is set. Run {\tt xmkmf -a} to have {\tt imake} build a {\tt Makefile} from the {\tt Imakefile} provided. Run {\tt make} to compile and build the binaries.



\section{Command line parameters}

{\bf Syntax:} \rt [options] {\tt <} input {\tt >} output 2 {\tt >} errors
\vspace{1em}
\begin{list}{}
{\setlength{\leftmargin}{3.5cm}
\setlength{\labelwidth}{3.0cm}
\setlength{\labelsep}{0.25cm}
\setlength{\rightmargin}{0.5cm}}

\item[{\tt [--append|-a]}] Append to output files. A new seed value for the random number generator is supplied by this parameter. This overrides the keyword {\tt seed} in the input file. Use this option to improve existing results by tracing additional rays and append to existing output files. Default mode is to truncate existing files.

\item[{\tt [--mode|-m]}] Select mode [012] for this run.
\begin{itemize}
\item[\tt -m0]{Check syntax of input [default].}
\item[\tt -m1]{Output {\tt OFF} files useful to visualize the geometry\footnote{geomview}.}
\item[\tt -m2]{Perform a ray tracing run.}
\end{itemize}

\item[{\tt [--threads|-t]}] {Set number of worker threads [1]. Typically, you want to set this parameter to the number of CPUs or cores available. ach worker thread uses its own rng seeded with {\tt seed}, {\tt seed}+1}, \ldots{}.

\item[{\tt [--help|-h]}] prints a help message.

\item[{\tt [--Version|-V]}] Prints the version number.

\end{list}


\section{Structure in input file}
Input is given by a series of 'keyword'='value' pairs and parsed by {\tt libconfig}. Note, that each definition ends with ';', that keywords and strings\footnote{in double quotes.} are both case sensitive, and that float values \emph{must} contain a decimal point. {\tt libconfig} treats everything after the \# character until the end of the line as comment, is white space agnostic, and allows up to ten levels of included files (via the {\tt @include "filename"} directive. For details on the syntax used in the configuration files, please consult the documentation of {\tt libconfig}.
The general structure of the input --- the order of the keyword being unimportant --- is as follows:

\begin{verbatim}
global_parameter_1 = value_1;
global_parameter_2 = value_2;
.
global_parameter_n = value_n;

sources = (
{definition of source_1},
{definition of source_2},
.
{definition of source_n}
);

targets = (
{definition of target_1}, 
{definition of target_2},
.
{definition of target_n}
);
\end{verbatim}

All sources and all targets are identified by their {\tt type}. The common {\tt name} keyword\footnote{must be unique.} is used as base name for the various output files\footnote{{\tt axes\_NAME.off} and {\tt NAME.off} (mode 1) and {\tt NAME.dat} for targets only (mode 2).}.

\subsection{Global Parameters}
\begin{itemize}
\item[{\bf seed}:]{Seed value (unsigned integer) for random number generator. Using the same seed value again will result in the identical sequence of pseudo random number and thus an identical output.\footnote{This is not true anymore if you use more than one worker thread. First, each worker uses its own rng and seed value. It produces an unique stream of pseudo random numbers. Second, the exact sequence with which blocks of output from the different worker are interleaved in the final output is non-deterministic. Third, the amount of work performed by an individual worker is non-deterministic.}\\
The value will be overridden by the {\tt -a} command line argument. Using this option, existing results can be improved by tracing additional rays.}
\end{itemize}



\subsection{Sources}

All sources define the keywords {\tt power} (double), {\tt n\_rays} (unsigned integer), and {\tt spectrum} (string) i.e.\ the total power assigned to the source, the number of rays that start from it, and the name of a file\footnote{The spectrum will be represented by a cubic spline interpolation of the data given in this file. Use a minimum number of data points to make the interpolation fast} containing the spectrum of the source. Each ray thus represents a power of {\tt power}/{\tt n\_rays} at a random wavelength.

\subsubsection{Uniform Point Source}

\noindent {\tt type="uniform point source";}

\noindent {\tt name="NAME";}

\noindent {\tt origin=[X.x, Y.y, Z.z];}

\noindent {\tt power=P.p;}

\noindent {\tt n\_rays=N;}

\noindent {\tt spectrum="FILE\_NAME";}

\vspace{0.25cm}
Defines an uniform point source located at {\tt origin}. 


\subsubsection{Spot Source}

\noindent {\tt type="spot source";}

\noindent {\tt name="NAME";}

\noindent {\tt origin=[X.x, Y.y, Z.z];}

\noindent {\tt direction=[X.x, Y.y, Z.z];}

\noindent {\tt theta=T.t;}

\noindent {\tt power=P.p;}

\noindent {\tt n\_rays=N;}

\noindent {\tt spectrum="FILE\_NAME";}

\vspace{0.25cm}
Defines a point source located at {\tt origin}. The source emits homogeneously into a cone pointing in {\tt direction}. {\tt theta} defines the angle between the edge of the cone and {\tt direction}. If {\tt theta=0.0} all rays are emitted in {\tt direction}. {\tt theta=180.0} defines an uniform point source. The direction vector {\tt direction} does not need to be normalized.

\subsubsection{Sphere}

\noindent {\tt type="sphere";}

\noindent {\tt name="NAME";}

\noindent {\tt origin=[X.x, Y.y, Z.z];}

\noindent {\tt radius=R.r;}

\noindent {\tt power=P.p;}

\noindent {\tt n\_rays=N;}

\noindent {\tt spectrum="FILE\_NAME";}

\vspace{0.25cm}
Defines an uniform spherical source of radius {\tt radius} located at {\tt origin}. Ray start at a random position inside the sphere in a random direction. Both, origin and direction of the ray are uniformly distributed.




\subsection{Targets}

\subsubsection{One-Side Plane Screen}

\noindent {\tt type="one-sided plane screen";}

\noindent {\tt name="NAME";}

\noindent {\tt point=[X.x, Y.y, Z.z];}

\noindent {\tt normal=[X.x, Y.y, Z.z];}

\noindent {\tt x=[X.x, Y.y, Z.z];}

\vspace{0.25cm}
Defines a transparent and non-absorbing infinite plane. The plane is defined by a point {\tt point} and the direction of its surface normal {\tt normal} that does not need to be normalized. {\tt x} defines the x axis of the local coordinate system. The y axis of the local, right-handed system follows from $y=z \times x$. The one-side plane screen registers all rays that intercept the plane anti-parallel to its normal vector.


\subsubsection{Two-Side Plane Screen}

\noindent {\tt type="two-sided plane screen";}

\noindent {\tt name="NAME";}

\noindent {\tt point=[X.x, Y.y, Z.z];}

\noindent {\tt normal=[X.x, Y.y, Z.z];}

\noindent {\tt x=[X.x, Y.y, Z.z];}

\vspace{0.25cm}
Defines a transparent and non-absorbing infinite plane. The plane is defined by a point {\tt point} and the direction of its surface normal {\tt normal} that does not need to be normalized. {\tt x} defines the x axis of the local coordinate system. The y axis of the local, right-handed system follows from $y=z \times x$. In contrast the the one-side plane screen the two-side plane screen registers \emph{all} rays that intercept the plane independent of their direction.


\subsubsection{Triangle}

\noindent {\tt type="triangle";}

\noindent {\tt name="NAME";}

\noindent {\tt P1=[X.x, Y.y, Z.z];}

\noindent {\tt P2=[X.x, Y.y, Z.z];}

\noindent {\tt P3=[X.x, Y.y, Z.z];}

\noindent {\tt reflectivity="FILE\_NAME";}

\vspace{0.25cm}
Defines a triangular reflecting surface. {\tt P1}, {\tt P2}, and {\tt P3} define the three vertices of the triangle. The surface normal of the triangle points towards the observer if {\tt P1}, {\tt P2}, and {\tt P3} are defined anti-clockwise. The surface normal\footnote{local z axis.} defined in this way points away from the reflective surface with reflectivity spectrum given by the file {\tt reflectivity}\footnote{The spectrum will be represented by a cubic spline interpolation of the data given in this file. Use a minimum number of data points to make the interpolation fast}. The opposite surface is non-reflecting and absorbs all rays that hit it. The origin of the local, right handed coordinate system is located at {\tt P1} and $P2 - P1$ defines the local x axis. 


\subsubsection{Rectangle}

\noindent {\tt type="rectangle";}

\noindent {\tt name="NAME";}

\noindent {\tt P1=[X.x, Y.y, Z.z];}

\noindent {\tt P2=[X.x, Y.y, Z.z];}

\noindent {\tt P3=[X.x, Y.y, Z.z];}

\noindent {\tt reflectivity="FILE\_NAME";}

\vspace{0.25cm}
Defines a rectangular reflecting surface of dimension $a \times b$. {\tt P1}, {\tt P2}, and {\tt P3}, the three vertices define the two perpendicular sides. $a=P2-P1$, is parallel to the local x axis and $b=P3 - P1$ is parallel to the local y axis. The local origin is at the center of the rectangle. The local z axis follows from the right handedness of the local system. The surface from which the z-axis points away is reflecting while the opposite surface absorbs all rays that hit it. The reflectivity spectrum of the target is given by the file {\tt reflectivity}.

\subsubsection{Ellipsoid}

\noindent {\tt type="ellipsoid;"}

\noindent {\tt name="NAME";}

\noindent {\tt center=[X.x, Y.y, Z.z];}

\noindent {\tt x=[X.x, Y.y, Z.z];}

\noindent {\tt z=[X.x, Y.y, Z.z];}

\noindent {\tt axes=[A.a, B.b, C.c];}

\noindent {\tt z\_min=I.i;}

\noindent {\tt z\_max=A.a;}

\noindent {\tt reflectivity="FILE\_NAME";}

\vspace{0.25cm}
Defines an ellipsoid\footnote{${x^2}/{a^2}+{y^2}/{b^2}+{z^2}/{c^2}=1$} in the local system with origin at {\tt origin}. {\tt x} and {\tt z} are the directions of the local x and z axes, respectively. The semi axes of the ellipsoid are given as {\tt axes}. The surface is only defined for $z_\mathrm{min} \leq z \leq z_\mathrm{max}$. Only the inside surface is reflecting while the outside surface absorbs all radiation. The reflectivity spectrum of the target is given by the file {\tt reflectivity}.

\subsubsection{Disk}

\noindent {\tt type="disk;"}

\noindent {\tt name="NAME";}

\noindent {\tt P=[X.x, Y.y, Z.z];}

\noindent {\tt N=[X.x, Y.y, Z.z];}

\noindent {\tt r=R.r;}

\noindent {\tt x=[X.x, Y.y, Z.z];}

\noindent {\tt reflectivity="FILE\_NAME";}

\vspace{0.25cm}
Defines a reflecting disk of radius {\tt r} with center at {\tt P} and normal vector {\tt N}. The normal vector point away from the reflecting surface. The backside of the disk has implicit absorptivity of 1.0. The spectral reflectivity of the front surface is defined in the file 'reflectivity'. {\tt x} defines the x axis and {\tt N} the z axis of the local coordinate system of the disk. If {\tt x} is not perpendicular to {\tt N} its perpendicular component (after normalization is used. The local y axis is calculated from $y = N \times x$.

\subsubsection{Annulus}

\noindent {\tt type="annulus;"}

\noindent {\tt name="NAME";}

\noindent {\tt P=[X.x, Y.y, Z.z];}

\noindent {\tt N=[X.x, Y.y, Z.z];}

\noindent {\tt R=R.r;}

\noindent {\tt r=R.r;}

\noindent {\tt x=[X.x, Y.y, Z.z];}

\noindent {\tt reflectivity="FILE\_NAME";}

\vspace{0.25cm}
Defines a reflecting annulus of radius {\tt R} with a hole of radius {\tt r}. The annulus is centered at {\tt P}, its orientation defined by its normal vector {\tt N}. The normal vector point away from the reflecting surface. The backside of the annulus has implicit absorptivity of 1.0. The spectral reflectivity of the front surface is defined in the file 'reflectivity'. {\tt x} defines the x axis and {\tt N} the z axis of the local coordinate system of the disk. If {\tt x} is not perpendicular to {\tt N} its perpendicular component (after normalization is used. The local y axis is calculated from $y = N \times x$.


\section{Utilities}
\subsection{{\tt spectrum}}

{\tt spectrum} reads the output file of a target produced by \rt and extract the spectrum (histogram) of the radiation absorbed by the target\footnote{or impinging on the target in case of a one- or two-sided plane screen}. Statistical data of the spectrum are reported in its header including the number of rays and their total power that fall outside the range considered. The spectrum is reported as power per wavelength interval.

{\bf Syntax:} {\tt spectrum} [options] {\tt <} input {\tt >} output 2 {\tt >} errors
\vspace{1em}
\begin{list}{}
{\setlength{\leftmargin}{3.5cm}
\setlength{\labelwidth}{3.0cm}
\setlength{\labelsep}{0.25cm}
\setlength{\rightmargin}{0.5cm}}

\item[{\tt [--num|-n]}] Number of bins used [10].
\item[{\tt [--start|-a]}] Start wavelength for spectrum [0.0].
\item[{\tt [--stop|-o]}] Stop wavelength for spectrum [2000.0].
\item[{\tt [--help|-h]}] prints a help message.
\item[{\tt [--Version|-V]}] Prints the version number.

\end{list}

\subsection{{\tt flux\_2D}}
{\tt flux\_2D} outputs the distribution of the absorbed flux (2D histogram) of planar targets. Statistical data including the number of rays missed and the total power contained in those is reported in the header.

{\bf Syntax:} {\tt flux\_2D} [options] {\tt <} input {\tt >} output 2 {\tt >} errors
\vspace{1em}
\begin{list}{}
{\setlength{\leftmargin}{3.5cm}
\setlength{\labelwidth}{3.0cm}
\setlength{\labelsep}{0.25cm}
\setlength{\rightmargin}{0.5cm}}

\item[{\tt [--nx|-a]}] Number of bins in x direction used [10].
\item[{\tt [--ny|-b]}] Number of bins in y direction used [10].
\item[{\tt [--minx|-x]}] Minimum x value of histogram [-10.0].
\item[{\tt [--maxx|-X]}] Maximum x value of histogram [10.0].
\item[{\tt [--miny|-y]}] Minimum y value of histogram [-10.0].
\item[{\tt [--maxy|-Y]}] Maximum y value of histogram [10.0].
\item[{\tt [--help|-h]}] prints a help message.
\item[{\tt [--Version|-V]}] Prints the version number.

\end{list}

\subsection{{\tt get\_flux}}
{\tt get\_flux} extracts the binary output datafiles producted by {\tt rt} and lists the data. It outputs\footnote{tab separated} $x$ $y$ power $\lambda$ for planar targets or $x$ $y$ $z$ power $\lambda$ otherwise.

{\bf Syntax:} {\tt get\_flux} [options] {\tt <} input {\tt >} output 2 {\tt >} errors
\vspace{1em}
\begin{list}{}
{\setlength{\leftmargin}{3.5cm}
\setlength{\labelwidth}{3.0cm}
\setlength{\labelsep}{0.25cm}
\setlength{\rightmargin}{0.5cm}}

\item[{\tt [--help|-h]}] prints a help message.
\item[{\tt [--Version|-V]}] Prints the version number.

\end{list}


\section{Availability}
\rt is free and available upon request from the author (ivo.alxneit@psi.ch).



\section{Bugs} Please send any bug report or fix or enhancement to the author. They probably will be include in a future version. However, {\bf no} actual support will be available from the author.

\end{document}



